import React from 'react';
import {
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Button,
  Typography,
  Box,
  Chip,
  Grid,
} from '@mui/material';
import { VulnerabilityData } from '../../types/vulnerability.types';
import { getSeverityColorName } from '../../utils/severityUtils';

interface DetailViewProps {
  vulnerability: VulnerabilityData | null;
  open: boolean;
  onClose: () => void;
}

/**
 * Detail view dialog for displaying complete vulnerability information
 */
export const DetailView: React.FC<DetailViewProps> = ({ vulnerability, open, onClose }) => {
  if (!vulnerability) return null;

  return (
    <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
      <DialogTitle>
        <Box display="flex" alignItems="center" gap={2}>
          <Typography variant="h5" component="span">
            Vulnerability Details
          </Typography>
          <Chip
            label={vulnerability.severity}
            color={getSeverityColorName(vulnerability.severity)}
            size="small"
          />
        </Box>
      </DialogTitle>

      <DialogContent dividers>
        <Grid container spacing={3}>
          {/* Package Information */}
          <Grid size={{ xs: 12 }}>
            <Typography variant="subtitle2" color="text.secondary">
              Package
            </Typography>
            <Typography variant="h6" gutterBottom>
              {vulnerability.package}
            </Typography>
          </Grid>

          {/* Version */}
          {vulnerability.version && (
            <Grid size={{ xs: 6 }}>
              <Typography variant="subtitle2" color="text.secondary">
                Version
              </Typography>
              <Typography variant="body1">{vulnerability.version}</Typography>
            </Grid>
          )}

          {/* CVE */}
          {vulnerability.cve && (
            <Grid size={{ xs: 6 }}>
              <Typography variant="subtitle2" color="text.secondary">
                CVE
              </Typography>
              <Typography variant="body1">{vulnerability.cve}</Typography>
            </Grid>
          )}

          {/* CVSS Score */}
          {vulnerability.cvss && (
            <Grid size={{ xs: 6 }}>
              <Typography variant="subtitle2" color="text.secondary">
                CVSS Score
              </Typography>
              <Typography variant="body1">{vulnerability.cvss}</Typography>
            </Grid>
          )}

          {/* KAI Status */}
          <Grid size={{ xs: 6 }}>
            <Typography variant="subtitle2" color="text.secondary">
              KAI Status
            </Typography>
            <Typography variant="body1">{vulnerability.kaiStatus}</Typography>
          </Grid>

          {/* Timestamp */}
          {vulnerability.timestamp && (
            <Grid size={{ xs: 6 }}>
              <Typography variant="subtitle2" color="text.secondary">
                Timestamp
              </Typography>
              <Typography variant="body1">
                {new Date(vulnerability.timestamp).toLocaleString()}
              </Typography>
            </Grid>
          )}

          {/* Description */}
          {vulnerability.description && (
            <Grid size={{ xs: 12 }}>
              <Typography variant="subtitle2" color="text.secondary" gutterBottom>
                Description
              </Typography>
              <Typography variant="body1">{vulnerability.description}</Typography>
            </Grid>
          )}

          {/* Risk Factors */}
          <Grid size={{ xs: 12 }}>
            <Typography variant="subtitle2" color="text.secondary" gutterBottom>
              Risk Factors
            </Typography>
            <Box display="flex" flexWrap="wrap" gap={1}>
              {vulnerability.riskFactors && vulnerability.riskFactors.length > 0 ? (
                vulnerability.riskFactors.map((factor, index) => (
                  <Chip key={index} label={factor} variant="outlined" size="small" />
                ))
              ) : (
                <Typography variant="body2" color="text.secondary">
                  No risk factors
                </Typography>
              )}
            </Box>
          </Grid>
        </Grid>
      </DialogContent>

      <DialogActions>
        <Button onClick={onClose} variant="contained" color="primary">
          Close
        </Button>
      </DialogActions>
    </Dialog>
  );
};

export default DetailView;
